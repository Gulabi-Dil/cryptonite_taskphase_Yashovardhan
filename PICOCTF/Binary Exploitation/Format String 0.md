# Description: 
Can you use your knowledge of format strings to make the customers happy?

Download the binary `here`.

Download the source `here`.

Connect with the challenge instance here: nc mimas.picoctf.net 50742
# Solution: 
This was the program provided in the attachment:
```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <signal.h>
#include <unistd.h>
#include <sys/types.h>

#define BUFSIZE 32
#define FLAGSIZE 64

char flag[FLAGSIZE];

void sigsegv_handler(int sig) {
    printf("\n%s\n", flag);
    fflush(stdout);
    exit(1);
}

int on_menu(char *burger, char *menu[], int count) {
    for (int i = 0; i < count; i++) {
        if (strcmp(burger, menu[i]) == 0)
            return 1;
    }
    return 0;
}

void serve_patrick();

void serve_bob();


int main(int argc, char **argv){
    FILE *f = fopen("flag.txt", "r");
    if (f == NULL) {
        printf("%s %s", "Please create 'flag.txt' in this directory with your",
                        "own debugging flag.\n");
        exit(0);
    }

    fgets(flag, FLAGSIZE, f);
    signal(SIGSEGV, sigsegv_handler);

    gid_t gid = getegid();
    setresgid(gid, gid, gid);

    serve_patrick();
  
    return 0;
}

void serve_patrick() {
    printf("%s %s\n%s\n%s %s\n%s",
            "Welcome to our newly-opened burger place Pico 'n Patty!",
            "Can you help the picky customers find their favorite burger?",
            "Here comes the first customer Patrick who wants a giant bite.",
            "Please choose from the following burgers:",
            "Breakf@st_Burger, Gr%114d_Cheese, Bac0n_D3luxe",
            "Enter your recommendation: ");
    fflush(stdout);

    char choice1[BUFSIZE];
    scanf("%s", choice1);
    char *menu1[3] = {"Breakf@st_Burger", "Gr%114d_Cheese", "Bac0n_D3luxe"};
    if (!on_menu(choice1, menu1, 3)) {
        printf("%s", "There is no such burger yet!\n");
        fflush(stdout);
    } else {
        int count = printf(choice1);
        if (count > 2 * BUFSIZE) {
            serve_bob();
        } else {
            printf("%s\n%s\n",
                    "Patrick is still hungry!",
                    "Try to serve him something of larger size!");
            fflush(stdout);
        }
    }
}

void serve_bob() {
    printf("\n%s %s\n%s %s\n%s %s\n%s",
            "Good job! Patrick is happy!",
            "Now can you serve the second customer?",
            "Sponge Bob wants something outrageous that would break the shop",
            "(better be served quick before the shop owner kicks you out!)",
            "Please choose from the following burgers:",
            "Pe%to_Portobello, $outhwest_Burger, Cla%sic_Che%s%steak",
            "Enter your recommendation: ");
    fflush(stdout);

    char choice2[BUFSIZE];
    scanf("%s", choice2);
    char *menu2[3] = {"Pe%to_Portobello", "$outhwest_Burger", "Cla%sic_Che%s%steak"};
    if (!on_menu(choice2, menu2, 3)) {
        printf("%s", "There is no such burger yet!\n");
        fflush(stdout);
    } else {
        printf(choice2);
        fflush(stdout);
    }
}
```
Too vast and overwhelming so first I ran the nc command 
```
yasho@DESKTOP-6ND4URA:~$ nc mimas.picoctf.net 63719
```
Output: 

Welcome to our newly-opened burger place Pico 'n Patty! Can you help the picky customers find their favorite burger?
Here comes the first customer Patrick who wants a giant bite.

Please choose from the following burgers: Breakf@st_Burger, Gr%114d_Cheese, Bac0n_D3luxe

Enter your recommendation: 

_It was asking for input so I went to the program and quickly glanced over the blocks where this burgers list comes into picture._

```
int count = printf(choice1);
        if (count > 2 * BUFSIZE) {
            serve_bob();
        } else {
            printf("%s\n%s\n",
                    "Patrick is still hungry!",
                    "Try to serve him something of larger size!");
            fflush(stdout);
        }
```
Realized that this block of code must be used for debugging because this determines the output after my interactive input. Also, in the beginning of the program, BUFSIZE is defined as 32; and `int count = printf(choice1);` will count the number of characters printed by printf (printf is printing our choice entered btw).
So, choice will satisfy condition if it has >64 characters.

I checked the burgers mentioned in the list and format specifiers have the symbol % included, so I looked up format specifiers in C just to confirm.
`Gr%114d_Cheese` is mentioned in first customer's burgers list and `%114d` in C is a format specifier which creates a number of 114 characters. If the integer is less than 114 characters then it will do padding before the integer such that the total width is 114 characters.

Examples:

`printf("%114d\n", 42);` will print 112 spaces and then the number 42.

`printf("%0114d\n", 42);` will print `0` 112 times before the number 42.

`printf("%-114d\n", 42);` will print 42 in left alignment.

Padding is mentioned between % and 1. If not, then it will print space. So, here `Gr%114d_Cheese` will have width more than 114 which is why it will satisfy the condition `count > 2*BUFSIZE`.

I entered `Gr%114d_Cheese` and it worked.

Output: 
```
Enter your recommendation: Gr%114d_Cheese
Gr                                                                                                           4202954_Cheese
Good job! Patrick is happy! Now can you serve the second customer?
Sponge Bob wants something outrageous that would break the shop (better be served quick before the shop owner kicks you out!)
Please choose from the following burgers: Pe%to_Portobello, $outhwest_Burger, Cla%sic_Che%s%steak
Enter your recommendation:
```
Now, using the same kinda logic for 2nd customer, I noticed that `Cla%sic_Che%s%steak` has %s in it, not once but twice at that. When `%s` is seen in printf statement, printf will look for a string argument for it. Here, there is no argument so it will generate some garbage value and print it. So, this would suffice for Bob's "outrageous" order?

Entered `Cla%sic_Che%s%steak` and it worked.

Output:
```
ClaCla%sic_Che%s%steakic_Che(null)
picoCTF{7h3_cu570m3r_15_n3v3r_SEGFAULT_ef312157}
```
# Flag:
>picoCTF{7h3_cu570m3r_15_n3v3r_SEGFAULT_ef312157}
